# US 2.2.13 — Create, Update Qualifications (ReadMe)

## Short summary
- **Purpose**: let Logistics Operators register and manage qualifications (create, update) so that staff members and resources can be consistently associated with the correct skills and certifications required for port operations.
- **Scope**: CRUD (create, update, search/filter). This story only records qualifications and their metadata — assignment/association to staff/resources is handled by other stories (US 2.2.11 and US 2.2.12).

## Acceptance checklist (quick)
- [ ] Each qualification has a unique code (alphanumeric, max 15 chars).
- [ ] Each qualification has a descriptive name (at least 2 words, max 150 chars).
- [ ] Code is unique and immutable after creation.
- [ ] Name must be at least 2 words and max 150 characters.
- [ ] Qualifications are searchable/filterable by code (partial) or name (partial).
- [ ] A qualification must exist before being assigned to staff or resources.

## Business rules (high level)
- **Code**: alphanumeric, maximum length of 15 characters, unique and immutable.
- **Name**: free text with at least two words and a maximum length of 150 characters.
- Code is stored in upper-case for consistency (normalized on input).
- Name is case-sensitive and stored as provided by the user.
- A qualification can be updated (name/description only; code cannot change).
- Staff members may have 0, 1 or multiple qualifications.
- Physical resources may require 0, 1 or multiple qualifications to be operated.
- Qualifications cannot be deleted if they are referenced by staff or resources (referential integrity).

## API contract (recommended endpoints)
- **POST** `/api/qualifications`
  - `CreateQualificationDto {
      QualificationId (code), Name, Description?
    }`
  - Responses: 201 Created, 409 Conflict (code exists), 400 Validation error.
- **PUT** `/api/qualifications/{id}`
  - `UpdateQualificationDto { Name?, Description? }`
  - Cannot change code (id in route).
  - Responses: 200 OK, 404 Not Found, 400 Validation error.
- **GET** `/api/qualifications`
  - Query params: id (code, partial match), name (partial match)
  - Behavior: partial match for code/name; returns all if no filters.
  - Responses: 200 OK + qualifications[]
- **GET** `/api/qualifications/{id}`
  - Responses: 200 OK + qualification, 404 Not Found.
- **DELETE** `/api/qualifications/{id}`
  - Responses: 204 No Content, 404 Not Found, 409 Conflict (if referenced by staff/resources).

## Diagrams (render .puml files in this folder)
- SSDs
  - US2-2-13_SSD_ListQualifications.puml — listing/search flow
  - US2-2-13_SSD_CreateQualification.puml — create flow
  - US2-2-13_SSD_UpdateQualification.puml — update flow
- Sequence diagrams
  - US2-2-13_SD_Create.puml, US2-2-13_SD_Update.puml
- Structural diagrams
  - US2-2-13_DM.puml — domain model
  - US2-2-13_CD.puml — class/controller/repository view

## Domain summary (concise)
- **Entity**: StaffMemberQualification (QualificationId string [PK], Name string, Description string?)
- **Core attributes**:
  - QualificationId (string, unique, immutable, alphanumeric, max 15 chars) — stored upper-case
  - Name (string, required, at least 2 words, max 150 chars)
  - Description (string?, optional, max 500 chars)
- **Key behaviors**: Create (validate code format and name), Update (name/description only), Delete (check references)
- **Relationships**: 
  - StaffMember "0..*" -- "0..*" StaffMemberQualification
  - PhysicalResource "0..*" -- "0..*" StaffMemberQualification

## DTOs (summary)
- `CreateQualificationDto { QualificationId, Name, Description? }`
- `UpdateQualificationDto { Name?, Description? }`
- `QualificationDto { QualificationId, Name, Description? }`

## Validation rules (server-side)
- **Code (QualificationId)**:
  - Alphanumeric only (regex: `^[A-Z0-9]+$` after normalization).
  - Max 15 characters.
  - Normalize to upper-case on input.
  - Unique across system.
  - Immutable after creation.
- **Name**:
  - Required.
  - At least 2 words (split by whitespace, must have >= 2 non-empty tokens).
  - Max 150 characters.
  - Trimmed but case preserved.
- **Description**:
  - Optional.
  - Max 500 characters if provided.

## Testing (suggested)
- `CreateQualification_Valid_ReturnsCreated`
- `CreateQualification_DuplicateCode_ReturnsConflict`
- `CreateQualification_InvalidCode_Returns400` (non-alphanumeric, too long)
- `CreateQualification_InvalidName_Returns400` (less than 2 words, too long)
- `UpdateQualification_CanModifyNameAndDescription`
- `UpdateQualification_CannotChangeCode` (code in route, not in body)
- `Search_FilterByCodeAndName`
- `DeleteQualification_ReferencedByStaff_ReturnsConflict`

## Implementation notes (practical)
- **Controller**: QualificationsController handles endpoints. Already exists with basic CRUD; enhance validation.
- **Repository**: QualificationRepository provides search by code/name (partial match). Already exists.
- **Domain**: StaffMemberQualification entity already exists. Add validation methods: ValidateCode, ValidateName.
- **Validation**:
  - Code: regex `^[A-Z0-9]{1,15}$` (after ToUpperInvariant).
  - Name: split by whitespace, count non-empty tokens, must be >= 2.
  - On create: check uniqueness of code (case-insensitive).
  - On update: ensure code is not in body (immutable).
  - On delete: check no FK references from StaffMembers.Qualifications or PhysicalResources.RequiredQualifications.
- **Persistence**: EF Core configuration already exists in PortDbContext. Ensure indexes for fast lookup.
- **Dev seed**: add a few qualifications to Program.cs for manual testing (already seeded: QUAL001, QUAL002).

## Minimal examples
- **Create Qualification**
  ```http
  POST /api/qualifications
  {
    "QualificationId": "CRANE01",
    "Name": "STS Crane Operator",
    "Description": "Qualified to operate ship-to-shore cranes"
  }
  ```

- **Update Qualification**
  ```http
  PUT /api/qualifications/CRANE01
  {
    "Name": "STS Crane Senior Operator",
    "Description": "Advanced STS crane operations including night shifts"
  }
  ```

- **Search**
  ```http
  GET /api/qualifications?name=crane
  ```

- **Delete**
  ```http
  DELETE /api/qualifications/CRANE01
  ```
  (Returns 409 if referenced by staff/resources)

## Notes / future work
- This story does not perform assignment/association to staff or resources. US 2.2.11 (staff) and US 2.2.12 (resources) handle those relationships.
- Consider adding an "active/inactive" flag if qualifications can become obsolete (e.g., expired certifications).
- Consider adding expiry dates or validity periods for certifications (future enhancement).
- Audit trail: track who created/modified qualifications (future enhancement).

## References
- See US2-2-13_* .puml diagrams in this folder for sequence/system flows and the domain/class diagrams to guide implementation.
- Existing controller: Controllers/QualificationsController.cs
- Existing domain entity: Domain/HumanResources/StaffMemberQualification.cs
- Existing repository: Infrastructure/Repositories/QualificationRepository.cs
