@startuml
title SSD â€“ Register Representative (Create)

actor "Port Authority Officer" as Officer
participant "API Client" as Client
participant "OrganizationsController" as C
participant "OrganizationRepository" as OR
participant "PortDbContext" as Db
participant "Organization (Domain)" as O
participant "Representative (Domain)" as R
database "EF (InMemory)" as Store

Officer -> Client : POST /api/organizations/{orgId}/representatives\n{ Name, CitizenId, Nationality, Email, Phone }
Client -> C : AddRepresentative(orgId, dto)
activate C

C -> OR : GetByIdAsync(orgId)
activate OR
OR -> Store : query Organization.Include(Representatives)
Store --> OR : Organization | null
deactivate OR

alt organization not found
  C --> Client : 404 Not Found\n"Organization with ID '...' not found."
  deactivate C
else organization found
  C -> O : O.AddRepresentatives(dto)
  activate O
  O -> O : validate business rules
  note right
    - At least one representative
    - Emails must be unique within organization
    - Required fields: Name, CitizenId, Nationality, Email
  end note
  O -> R : create Representative object(s)
  O --> C : representative(s) added
  deactivate O

  C -> OR : Update(O)
  activate OR
  C -> Db : SaveChangesAsync()
  Db -> Store : insert Representatives
  Store --> Db : OK
  deactivate OR

  C --> Client : 201 Created + RepresentativeResponseDto
  deactivate C
end
@enduml
