@startuml
title SSD â€“ Update Representative

actor "Port Authority Officer" as Officer
participant "API Client" as Client
participant "OrganizationsController" as C
participant "OrganizationRepository" as OR
participant "PortDbContext" as Db
participant "Representative (Domain)" as R
participant "Organization (Domain)" as O
database "EF (InMemory)" as Store

Officer -> Client : PUT /api/organizations/{orgId}/representatives/{repId}\n{ Name, CitizenId, Nationality, Email, Phone, IsActive }
Client -> C : UpdateRepresentative(orgId, repId, dto)
activate C

C -> OR : GetByIdAsync(orgId)
activate OR
OR -> Store : query Organization.Include(Representatives)
Store --> OR : Organization | null
deactivate OR

alt organization not found
  C --> Client : 404 Not Found\n"Organization with ID '...' not found."
  deactivate C
else organization found
  C -> O : O.GetRepresentativeById(repId)
  activate O
  O -> R : representative | null
  deactivate O

  alt representative not found
    C --> Client : 404 Not Found\n"Representative with ID '...' not found."
    deactivate C
  else representative found
    C -> R : update fields from DTO
    R -> R : validate business rules
    note right
      - Required fields: Name, CitizenId, Nationality, Email
      - Emails must remain unique in the organization
      - Can toggle IsActive
    end note
    C -> OR : Update(O)
    activate OR
    C -> Db : SaveChangesAsync()
    Db -> Store : update Representative
    Store --> Db : OK
    deactivate OR

    C --> Client : 200 OK + RepresentativeResponseDto
    deactivate C
  end
end
@enduml
