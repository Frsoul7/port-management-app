@startuml
title US 4.1.2 - Nível 1 (Visão Arquitetural / Camadas)

skinparam componentStyle rectangle
skinparam shadowing false

actor "Logistics Operator" as Op
rectangle "SPA (UI)" as SPA

package "OEM Service" {
  rectangle "REST API" as API

  package "Presentation" {
    [VesselVisitExecutionController] as C
    [Auth Middleware] as Auth
  }

  package "Application" {
    [VesselVisitExecutionService] as S
  }

  package "Domain" {
    [VesselVisitExecution] as VVE
    [CargoOperation] as CO
    [VveStatus] as Status
    [IVesselVisitExecutionRepository] as IRepo
  }

  package "Infrastructure" {
    [MongoVesselVisitExecutionRepository] as MongoRepo
    database "MongoDB" as DB
  }
}

Op --> SPA : Starts VVE (record berthing)
SPA --> API : POST /vessel-visit-executions/{id}/berth\n{berthTime}

API --> Auth
Auth --> C : authorized request
C --> S : startVve(...)
S --> IRepo : get/update (DIP)
IRepo <|.. MongoRepo
MongoRepo --> DB

S --> VVE : recordBerthing(...)
VVE ..> Status : PLANNED -> IN_PROGRESS

note right of S
Dependency Rule:
Presentation/Application depend on Domain.
Infrastructure depends on Domain interfaces.
end note

@enduml
